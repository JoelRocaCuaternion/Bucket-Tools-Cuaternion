<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Cuaternion Buckets Tools</title>
  <link rel="icon" type="image/x-icon" href="./logo.ico" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="./main.css" />
  <link rel="stylesheet" href="./issues.css" />
  <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.css" />
  <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="vh-100 overflow-hidden">
  <!-- Header con login -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light px-3">
    <a class="navbar-brand" href="#">
      <img src="./logo.png" height="50px" alt="Cuaternion" />
    </a>
    <span class="navbar-text me-auto">Cuaternion Forge Sample</span>
    <form class="d-flex" id="login-form">
      <input class="form-control me-2" type="text" placeholder="Client ID" id="client_id" name="client_id" required />
      <input class="form-control me-2" type="password" placeholder="Client Secret" id="client_secret" name="client_secret" required />
      <button class="btn btn-outline-success" type="submit" id="loginBtn">Login</button>
    </form>
  </nav>

  <!-- Botones Flotantes para menú-->
  <button class="btn btn-primary toggle-btn-left" id="floatingLeftBtn" onclick="toggleLeftPanel()" style="display: none;">
      ⮞ Panel
  </button>
  <button class="btn btn-primary toggle-btn-right" id="floatingRightBtn" onclick="toggleRightPanel()" style="display: none;">
      ⮜ Incidencias
  </button>

  <!-- Main layout -->
  <div class="container-fluid h-100">
    <div class="d-flex h-100 w-100" id="mainContent">
      <!-- Panel izquierdo -->
      <div class="panel panel-left bg-light pt-3 d-flex flex-column" id="panel-izquierdo">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong>Panel</strong>
          <button class="btn btn-sm btn-outline-secondary" onclick="toggleLeftPanel()">⮜</button>
        </div>

        <div class="input-group mb-2">
          <input type="file" class="form-control" id="input" />
        </div>

        <button id="upload" class="btn btn-primary mb-2" onclick="uploadFile()">Upload</button>
        <div class="row">
          <div class="col-6">
            <button class="btn btn-warning w-100 mb-2" onclick="exportarPropiedades()">Exportar a JSON</button>
          </div>
          <div class="col-6">
            <button class="btn btn-success w-100 mb-2" onclick="exportarPropiedadesExcel()">Exportar a Excel</button>
          </div>
        </div>

        <button class="btn btn-danger mb-2" onclick="escalarObjeto()">Escalar / Desescalar Objeto</button>

        <ul id="tree-models" class="treeview"></ul>
      </div>

      <!-- Visor 3D -->
       <div class="viewer flex-grow-1 p-0" id="viewerContainer">
        <div id="preview"></div>
      </div>

      <!-- Panel de incidencias -->
       <div class="panel panel-right bg-light p-0 d-flex flex-column" id="issuesPanel">
        <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
          <strong>Incidencias</strong>
          <button class="btn btn-sm btn-outline-secondary" onclick="toggleRightPanel()">⮞</button>
        </div>
            <div class="panel-header">
                <span>Incidencias</span>
            </div>
            
            <!-- Sección de filtros -->
            <div class="filters-section">
                <div class="filter-group">
                    <label class="filter-label">Buscar</label>
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar incidencias...">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Severidad</label>
                    <div class="filter-buttons">
                        <button class="filter-btn severity-high active" data-filter="severity" data-value="high">Alta</button>
                        <button class="filter-btn severity-medium active" data-filter="severity" data-value="medium">Media</button>
                        <button class="filter-btn severity-low active" data-filter="severity" data-value="low">Normal</button>
                    </div>
                </div>
            </div>
            
            <!-- Contador de resultados -->
            <div class="results-count" id="resultsCount">
                Mostrando 0 de 0 incidencias
            </div>
            
            <div class="issues-list" id="issuesList">
                <!-- Las incidencias se generarán dinámicamente -->
            </div>
        </div>
    </div>
  </div>

  <div id="overlay" style="display:none;">
    <div class="notification">
      <button id="closeOverlay" aria-label="Cerrar overlay" 
        style="position:absolute; top:10px; right:15px; border:none; background:none; font-size:1.5em; cursor:pointer;">×</button>
      <div id="notificationContent"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="./main.js"></script>
  <script type="module" src="./subir.js"></script>
  <script type="module" src="./viewer.js"></script>
  <script src="issues.js"></script>

</body>
</html>
